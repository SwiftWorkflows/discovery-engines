#!/usr/bin/env tclsh

lappend auto_path /home/wozniak/mcs/ShellTools/tcl
package require woztools 0.0

set template "/home/wozniak/proj/d-e/nexus/bin/chess/sge.sh.m4"

set env(X) 3

set dir     [ head argv ]
set jobname [ head argv ]
set env(JOBNAME) $jobname
set env(COMMAND) $argv

cd $dir
exec m4 < $template > $jobname.sh

set output [ exec qsub $jobname.sh ]
set job_id [ lindex $output 2 ]
show job_id

set max_delay 20
set delay 5
while true {
    after [ expr $delay * 1000 ]
    set output [ exec qstat ]
    if { [ string first $job_id $output ] < 0 } break
    if { $delay < $max_delay } { incr delay }
}
